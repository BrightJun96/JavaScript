# 비동기 프로그래밍

비동기 프로그래밍의 동작 원리는 나름 까다로운 개념이다.

실행컨텍스트,태스크 큐,이벤트 루프, 싱글 스레드, 멀티 스레드 등 여러가지 어려운 개념과 얽혀있기 때문이다.

**동기 함수**는 이전 테스크가 응답되지 않으면 다음 테스크가 진행되지 않는다.

**비동기 함수**는 이전 테스크가 응답되지 않아도 다음 테스크가 진행되도록 할 수 있다.

## 비동기 프로그래밍이 동작하는 원리

- 비동기 처리 방식은 이전 태스크가 종료되지 않아도 다음 태스크를 진행할 수 있게 한다.

- 하지만 자바스크립트 엔진은 싱글 스레드로 작동한다.
  싱글 스레드란 한번에 한가지일만 할 수 있는 것이다.
  따라서 자바스크립트 엔진만으로는 비동기 처리 방식을 실행할 수 없다.

- 브라우저는 멀티스레드 즉 한번에 여러가지 태스크를 진행할 수 있기 때문에 비동기적으로 동작할 수 있다.
  함수가 처리될 때 비동기 함수의 콜백함수는 콜스택이 진행됨과 동시에 브라우저에 의해 호출 스케쥴링되며  
  이벤트 루프에 의해 태스크 큐로 옮겨지며 콜스택이 비게 되면 태스크 큐에서 콜스택으로 옮겨지게 된다.

## Keyword

**실행 컨텍스트 스택(call stack)**

함수의 실행 컨텍스트들이 푸시(push)되고 팝(pop)되는 영역
함수의 실행 순서를 관리할 수 있다.
동기적으로 작동된다.

**태스크 큐(task queue)**

비동기 함수의 콜백함수나 이벤트 핸들러가 일시적으로 보관되는 장소

**마이크로태스크 큐(microtask queue)**

promise의 후속 처리 메서드의 콜백함수가 일시적으로 보관되는 장소

> **Note**  
> 태스크 큐와 마이크로태스크 큐에 있는 콜백함수 중 마이크로태스크 큐에 있는 콜백함수가 **실행우선순위가 더 높다.**  
> 이벤트 루프는 콜 스택이 비면 먼저 마이크로태스크 큐에서 대기하고 있는 함수를 가져와 실행한다.  
> 이후 마이크로태스크 큐가 비면 태스크 큐에서 대기하고 있는 함수를 가져와 실행한다.

**이벤트 루프(event loop)**

콜 스택에 실행중인 실행 컨텍스트가 있는지 확인하고 태스크 큐에 대기중인 콜백함수나 이벤트핸들러가 있는지 확인한다.

콜 스택이 비어있고 태스크 큐에 대기중인 함수가 있다면 함수들을 순차적으로 콜 스택으로 옮겨준다.

**싱글 스레드(single thread)**

한 번에 한 가지 태스크만 처리할 수 있다.

**멀티 스레드(multi thread)**

한 번에 여러가지 태스크를 처리할 수 있다.

> 비동기적으로 동작하는 함수들
>
> - HTTP 요청
> - setTimeout
> - setInterval
> - 이벤트 핸들러
